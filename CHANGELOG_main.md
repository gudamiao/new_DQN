# main.py ä¿®æ”¹æ—¥å¿—ï¼ˆæŒ‡æ ‡æ‰©å±•ç‰ˆï¼‰
10æœˆ15
## æ¦‚è¿°
ä¸ºæ»¡è¶³â€œç”¨**ç¢°æ’ç‡**æ›¿ä»£ PDR å±•ç¤ºã€å¼•å…¥ **SU ä¸ PU ç«äº‰æ—¶çš„æˆåŠŸç‡**ã€ç”¨ **å¹³å‡ååé‡**æ›¿ä»£æ€»ååå±•ç¤ºâ€çš„éœ€æ±‚ï¼Œæ›´æ–°äº†è®­ç»ƒè„šæœ¬ `main.py`ï¼Œæ–°å¢åº•å±‚é‡‡æ ·æŒ‡æ ‡ã€æ´¾ç”Ÿç»Ÿè®¡æŒ‡æ ‡ï¼Œå¹¶æ‰©å±•äº† CSV è¾“å‡ºå­—æ®µï¼Œä¾¿äºåç»­ç”»å›¾è„šæœ¬ç›´æ¥è¯»å–å¹¶å‡ºå›¾ã€‚

---

## å˜æ›´è¯¦æƒ…

### 1) ç¯å¢ƒè®¡æ•°å™¨ï¼ˆEnv.metricsï¼‰æ‰©å±•
**ä½ç½®**ï¼š`MultiAccessEnv._zero_metrics()`ã€`MultiAccessEnv.step()`

- **æ–°å¢å­—æ®µ**
  - `su_tx_compete_pu`ï¼šSU åœ¨ä¸ PU ç«äº‰åŒä¸€ä¿¡é“æ—¶çš„**å°è¯•æ¬¡æ•°**
  - `su_success_compete_pu`ï¼šä¸Šè¿°ç«äº‰åœºæ™¯ä¸‹ï¼ŒSU çš„**æˆåŠŸæ¬¡æ•°**
- **ç»Ÿè®¡é€»è¾‘**
  - åœ¨ `step()` ä¸­æ ¹æ®æ¯ä¸ªä¿¡é“æ˜¯å¦æœ‰ PU å‚ä¸ï¼ˆ`pu_present[k]`ï¼‰æ¥åˆ¤æ–­â€œSU æ˜¯å¦åœ¨ä¸ PU ç«äº‰â€ã€‚
  - è‹¥ SU åœ¨è¯¥ä¿¡é“å‘èµ·ä¼ è¾“ä¸” `pu_present[k] == True`ï¼Œåˆ™ `su_tx_compete_pu += 1`ã€‚è‹¥å½“æ‹ SU æˆä¸ºèµ¢å®¶ï¼Œåˆ™ `su_success_compete_pu += 1`ã€‚
- å…¶ä½™åŸæœ‰è®¡æ•°ï¼ˆ`tx/success/collision/wait/sum_throughput`ã€å„ç±» collision åˆ†è§£ã€PU/SU çš„ tx å’Œ success ç­‰ï¼‰ä¿æŒä¸å˜ã€‚

> ç›®çš„ï¼šæ”¯æŒè®¡ç®— **SU åœ¨ä¸ PU ç«äº‰æ—¶çš„æˆåŠŸç‡**ï¼Œä½œä¸ºå…¬å¹³æ€§/æ¥å…¥èƒ½åŠ›çš„é‡è¦æŒ‡æ ‡ã€‚

---

### 2) è®­ç»ƒå›åˆåçš„æ´¾ç”ŸæŒ‡æ ‡ï¼ˆtrain_oneï¼‰
**ä½ç½®**ï¼š`train_one()`ï¼ˆæ¯ä¸ª episode ç»“æŸæ—¶ï¼‰

æ–°å¢è®¡ç®—å¹¶è®°å½•ä»¥ä¸‹æ´¾ç”ŸæŒ‡æ ‡ï¼š
- `pdr_total = success / tx`ï¼ˆä¿ç•™åŸæœ‰â€œæ•´ä½“æˆåŠŸç‡â€ï¼Œä¾¿äºå¯¹æ¯”ï¼‰
- `coll_rate = collision / tx`ï¼ˆ**ç¢°æ’ç‡**ï¼Œç”¨äºæ›¿ä»£ PDR çš„å¯¹å¤–å±•ç¤ºï¼‰
- `wait_percent = wait / (episode_len * num_users) * 100`ï¼ˆç­‰å¾…å æ¯”ï¼Œå•ä½ %ï¼‰
- `coll_per_100 = collision / (episode_len * num_users) * 100`ï¼ˆæ¯ç™¾æ­¥ç¢°æ’æ•°ï¼‰
- `su_compete_success_rate = su_success_compete_pu / su_tx_compete_pu`ï¼ˆSU å¯¹ PU ç«äº‰æˆåŠŸç‡ï¼›æ— ç«äº‰æ—¶å®šä¹‰ä¸º 0.0ï¼‰
- `throughput = sum_throughput / (episode_len * num_users)`ï¼ˆ**å¹³å‡ååé‡**ï¼Œç”¨äºæ›¿ä»£æ€»ååå±•ç¤ºï¼›åŸå§‹ `sum_throughput` ä»ä¿ç•™ä»¥å…¼å®¹å†å²ï¼‰

> ç›®çš„ï¼šè®©ç”»å›¾è„šæœ¬æ— éœ€å†æ¨å¯¼ï¼Œç›´æ¥è¯»å–å³å¯ä½œå›¾ï¼›åŒæ—¶ä¿ç•™å…³é”®åŸå§‹é‡ï¼Œä¾¿äºå®¡è®¡ä¸äºŒæ¬¡åˆ†æã€‚

---

### 3) CSV è¾“å‡ºå­—æ®µæ‰©å±•
**ä½ç½®**ï¼š`train_one()` ä¿å­˜ `metrics_multi_roles.csv` å¤„

æ–°å¢æˆ–è°ƒæ•´åçš„ CSV è¡¨å¤´ï¼ˆé¡ºåºå›ºå®šï¼Œå…¼å®¹ç”»å›¾è„šæœ¬ï¼‰ï¼š
```
episode, return,
tx, success, collision, wait,
coll_incumbent, coll_multi, coll_preempt_su,
tx_pu, success_pu, tx_su, success_su,
pdr_total,          # æ€»ä½“æˆåŠŸç‡
coll_rate,          # ç¢°æ’ç‡ï¼ˆåç»­å±•ç¤ºä¸»æŒ‡æ ‡ï¼‰
wait_percent,       # ç­‰å¾…å æ¯”ï¼ˆ%ï¼‰
coll_per_100,       # æ¯ç™¾æ­¥ç¢°æ’
sum_throughput,     # åŸæ€»ååï¼ˆä¿ç•™ï¼‰
throughput,         # æ–°ï¼šå¹³å‡ååé‡ï¼ˆæ¯æ§½ï¼‰
su_tx_compete_pu, su_success_compete_pu, su_compete_success_rate
```

> å…¼å®¹æ€§ï¼šæ—§åˆ—åï¼ˆå¦‚ `sum_throughput`ï¼‰ä»ä¿ç•™ï¼›æ–°å¢ `throughput` ä½œä¸ºæ¨èå±•ç¤ºé¡¹ã€‚ç”»å›¾è„šæœ¬å¯ç›´æ¥ä½¿ç”¨æ–°åˆ—ã€‚

---

### 4) è®­ç»ƒæ—¥å¿—æ‰“å°è°ƒæ•´
**ä½ç½®**ï¼š`train_one()` ä¸­ `if ep % log_every == 0:` çš„æ‰“å°

- å¢åŠ äº† `SuccRate`ï¼ˆ= `pdr_total`ï¼‰ä¸ `CollRate`ï¼ˆ= `coll_rate`ï¼‰çš„å¹¶è¡Œæ‰“å°ï¼Œæ–¹ä¾¿å¯¹ç…§ã€‚
- æ›¿æ¢å±•ç¤ºé¡¹ï¼šç”¨ `Throughput`ï¼ˆå¹³å‡ååé‡ï¼‰æ›¿ä»£åŸâ€œSumThrâ€ï¼Œä½†ä¸ºé¿å…ä¿¡æ¯ä¸¢å¤±ï¼Œä»æ‰“å° `Coll/100`ã€`Wait%` ç­‰ã€‚

**ç¤ºä¾‹è¾“å‡º**
```
[base] Ep XXXX | Return XXXXX | AvgLoss X.XXXX | Eps X.XXX |
SuccRate 0.8XX | CollRate 0.0XX | Coll XXXX | Wait XXXX |
Coll/100 X.X | Wait% XX.X | Throughput 0.XXXX
```

---

### 5) è¯„ä¼°æµç¨‹ï¼ˆevaluateï¼‰
**ä½ç½®**ï¼š`evaluate()`  
- è¯„ä¼°é€»è¾‘æœ¬èº«æœªæ”¹å˜ï¼›ä¾ç„¶åŸºäº best ckpt åš 20 å›åˆçº¯è´ªå¿ƒè¯„ä¼°å¹¶æ‰“å°æ±‡æ€»ï¼ˆä¾¿äºçºµå‘å¯¹æ¯”ï¼‰ã€‚  
- æœ¬æ¬¡æ”¹åŠ¨é›†ä¸­åœ¨è®­ç»ƒæ—¶çš„æŒ‡æ ‡é‡‡æ ·ä¸å¯¼å‡ºï¼Œä¸å½±å“è¯„ä¼°æ¥å£ã€‚

---

### 6) è·¯å¾„ä¸äº§ç‰©
- è®­ç»ƒäº§ç‰©ç»Ÿä¸€å†™åˆ°ï¼š`outputs/sc_<tag>/`
  - æ¨¡å‹ï¼š`dqn_multi_roles.pth`ã€`dqn_multi_roles_best.pth`
  - æŒ‡æ ‡ï¼š`metrics_multi_roles.csv`ï¼ˆ**æœ¬æ¬¡æœ‰æ‰©å±•**ï¼‰
  - å…ƒä¿¡æ¯ï¼š`run_meta.json`ï¼ˆç”¨äºè®°å½• `episode_len/num_users/num_channels/...`ï¼‰

> ç”»å›¾è„šæœ¬ï¼ˆæ–°ç‰ˆ `plot_metrics.py`ï¼‰ä¼šè‡ªåŠ¨è¯»å– `metrics_multi_roles.csv`ï¼›è‹¥æœªæä¾›è·¯å¾„ï¼Œä¼šåœ¨å·¥ä½œç›®å½•ä¸‹é€’å½’æœç´¢æœ€æ–°çš„ä¸€ä¸ªã€‚

---

## è®¾è®¡å–èˆ / æ³¨æ„äº‹é¡¹

1. **é™¤é›¶ä¿æŠ¤**
   - å½“ `tx == 0` æˆ– `su_tx_compete_pu == 0` æ—¶ï¼Œå¯¹åº”æ¯”ç‡å®šä¹‰ä¸º `0.0`ï¼Œé¿å… NaN/Inf æ±¡æŸ“æ›²çº¿ã€‚

2. **å¹³å‡ååé‡**
   - å‡ºå›¾æ¨èä½¿ç”¨ `throughput = sum_throughput / (episode_len * num_users)`ï¼Œåˆ©äºä¸åŒå‚æ•°/è´Ÿè½½ä¸‹æ¨ªå‘å¯¹æ¯”ã€‚
   - åŸå§‹ `sum_throughput` ä»ä¿ç•™ï¼Œæ–¹ä¾¿æ ¸å¯¹/å®¡è®¡ã€‚

3. **å…¼å®¹æ—§æµç¨‹**
   - ä¿ç•™äº†æ—§çš„å…³é”®å­—æ®µï¼ˆå¦‚ `sum_throughput`ã€`pdr_total`ï¼‰ï¼Œå³ä½¿ä½ æš‚æ—¶ä¸æ›´æ–°ç”»å›¾è„šæœ¬ä¹Ÿèƒ½ç»§ç»­ç”¨ï¼›ä½†æ¨èå‡çº§åˆ°æ–°ç”»å›¾è„šæœ¬ä»¥ç›´æ¥å±•ç¤ºâ€œç¢°æ’ç‡/ååé‡/SU ç«äº‰æˆåŠŸç‡â€ã€‚

4. **å¯¹ç®—æ³•è¡Œä¸ºçš„å½±å“**
   - æœ¬æ¬¡æ”¹åŠ¨**ä¸æ”¹å˜**æ™ºèƒ½ä½“è®­ç»ƒé€»è¾‘ä¸å¥–åŠ±å®šä¹‰ï¼ˆä»…åœ¨**ç»Ÿè®¡å£å¾„**ä¸**å¯¼å‡º**ä¸Šæ‰©å±•ï¼‰ï¼›è®­ç»ƒæ›²çº¿è¶‹åŠ¿åº”ä¸æ—§ç‰ˆä¸€è‡´ã€‚

---

10æœˆ16
# **_å­˜åœ¨é—®é¢˜ï¼šsuä¸èƒ½æˆåŠŸæ¥å…¥**_
æœ¬äººæƒ³æ³•ï¼šå¯ä»¥å…±äº«é¢‘è°±èµ„æºï¼Œç­–ç•¥ï¼šé¢‘åˆ†å¤ç”¨æŠ€æœ¯ï¼›
# å˜æ›´æ—¥å¿—ï¼ˆCHANGELOGï¼‰

> é¡¹ç›®ï¼š**Multi-Channel Multi-User DQN with PU/SU Roles (+ V2X guard window & PU duty)**  
> ç‰ˆæœ¬ï¼š`v2x-guard-duty-integration`  
> æ—¥æœŸï¼š2025-10-16  
> ä½œè€…ï¼š@robertswaters8219 & GPT-5 Thinking

---

## âœ¨ æ–°å¢åŠŸèƒ½ï¼ˆFeature Additionsï¼‰

### A) SU ä¿æŠ¤çª—å£ï¼ˆV2X Guard Windowï¼‰
- åœ¨ V2X ç¬¬ä¸‰æ®µ `rsu_suggest` ä¸­å¼•å…¥**SU ä¿æŠ¤æ©ç **ï¼šæ¯æ‹é€‰æ‹©ä¸€å®šæ¯”ä¾‹çš„ä¿¡é“ä½œä¸ºâ€œå»ºè®®=ä¿æŠ¤â€ä¿¡é“ã€‚
- **è¡Œä¸º**ï¼š
  - **SU** åœ¨â€œå»ºè®®ä¿¡é“â€ä¸Šè·å¾—æ­£å‘åç½®ï¼ˆQ å€¼åŠ åˆ†ï¼‰ã€‚
  - **PU** åœ¨â€œå»ºè®®ä¿¡é“â€ä¸Šè·å¾—è´Ÿå‘åç½®ï¼ˆQ å€¼å‡åˆ†ï¼‰ã€‚
- **ç›®æ ‡**ï¼šç»™ SU åˆ›é€ æ›´ç¨³å®šçš„æ¥å…¥çª—å£ã€é™ä½ä¸ PU çš„æ­£é¢å†²çªã€‚

### B) PU å ç©ºæ¯”ï¼ˆPU Duty / `pu_tx_prob`ï¼‰
- å³ä¾¿ PU **é€‰æ‹©äº†å‘å°„åŠ¨ä½œ**ï¼Œä¹Ÿä»…ä»¥ `pu_tx_prob` çš„æ¦‚ç‡**çœŸæ­£å°è¯•**ï¼›å¦åˆ™â€œé™é»˜â€ï¼ˆç­‰ä»·ç­‰å¾…ï¼‰ã€‚
- **ç›®æ ‡**ï¼šé™ä½ PU å¯¹ SU çš„æŒç»­å‹åˆ¶ï¼Œä¸º SU æä¾›æ›´å¤šå¯å­¦ä¹ çš„æˆåŠŸæ ·æœ¬ã€‚

---

## ğŸ§© æ–°å¢/è°ƒæ•´çš„é…ç½®é¡¹

### `EnvConfig`
- `su_guard_frac: float = 0.0` â€” æ¯æ‹â€œä¿æŠ¤ä¿¡é“â€å æ¯”ï¼ˆ0~1ï¼‰ï¼Œå¦‚ `0.25` è¡¨ç¤º 25% ä¿¡é“å—ä¿æŠ¤ã€‚
- `su_guard_rotate: bool = True` â€” æ˜¯å¦**è½®åŠ¨**ä¿æŠ¤çª—å£ï¼Œä»¥ä¿è¯**å…¬å¹³æ€§**ã€‚
- `pu_tx_prob: float = 1.0` â€” PU çœŸå®å‘å°„æ¦‚ç‡ï¼ˆå°äº 1 æ—¶ç”Ÿæ•ˆï¼‰ã€‚
- ï¼ˆä¿ç•™ï¼‰`use_v2x, v2x_noise_std, v2x_latency_slots`ã€‚

### `DQNConfig`
- `v2x_suggest_pu_malus: float = 1.0` â€” PU åœ¨**ä¿æŠ¤ä¿¡é“**ä¸Šçš„å‡åˆ†å¼ºåº¦ï¼ˆä¸ `softmask_v2x_suggest` å¯¹ SU çš„åŠ åˆ†å¯¹å¶ï¼‰ã€‚
- ï¼ˆä¿ç•™ï¼‰`softmask_v2x_suggest, softmask_v2x_avoid_winner, sticky_bias` ç­‰ã€‚

---

## ğŸ— ç¯å¢ƒå±‚ï¼ˆEnvironmentï¼‰æ”¹åŠ¨è¦ç‚¹

1. **å ç©ºæ¯”ä½œç”¨äºâ€œæœ‰æ•ˆåŠ¨ä½œâ€**ï¼š
   - åœ¨ `step()` ä¸­å°†è¾“å…¥ `actions` æ˜ å°„ä¸º `effective_actions`ï¼šå¯¹ PU ä»¥ `pu_tx_prob` å†³å®šæ˜¯å¦é™é»˜ã€‚
   - åç»­**é€‰æ‹©ç»Ÿè®¡ã€èƒœè€…åˆ¤å®šã€å¥–åŠ±**å…¨éƒ¨åŸºäº `effective_actions`ã€‚

2. **è¿”å›â€œç”Ÿæ•ˆåŠ¨ä½œâ€**ï¼š
   - `info["effective_actions"] = effective_actions` ä¾›è®­ç»ƒ/è¯„ä¼°ä½¿ç”¨ï¼Œé¿å…æŠŠ PU çš„â€œé™é»˜â€è¯¯è®¡ä¸ºå°è¯•ã€‚

3. **V2X ç¬¬ä¸‰æ®µå˜æ›´**ï¼š
   - `_build_v2x()`ï¼šå½“ `su_guard_frac > 0` æ—¶ï¼Œç”¨**ä¿æŠ¤çª—å£æ©ç **è¦†ç›– `rsu_suggest`ï¼›æ”¯æŒ**è½®åŠ¨**æˆ–**éšæœºæŠ½æ ·**ã€‚

4. **éšæœºæ•°å®‰å…¨**ï¼š
   - ä¿æŠ¤çª—å£éšæœºæŠ½æ ·ä½¿ç”¨**å±€éƒ¨ç”Ÿæˆå™¨**ï¼Œä¸æ±¡æŸ“å…¨å±€ RNG çŠ¶æ€ï¼Œä¿è¯å®éªŒå¤ç°æ€§ã€‚

---

## ğŸ§  DQN å†³ç­–é€»è¾‘æ”¹åŠ¨

1. **è§’è‰²åŒ– V2X åç½®**ï¼š
   - åœ¨ `_apply_softmask_and_tiebreak()` å’Œ `select_batch()` ä¸­ï¼š
     - SUï¼š`+ softmask_v2x_suggest * rsu_suggest`
     - PUï¼š`- v2x_suggest_pu_malus * rsu_suggest`
   - ç»§ç»­ä¿ç•™ï¼š**å¿™ä¿¡é“è½¯æƒ©ç½š**ã€**å”¯ä¸€èµ¢å®¶ä¿¡é“æƒ©ç½šï¼ˆå¯é€‰ï¼‰**ã€**ç²˜æ»æ€§**ä¸**æ‰“æ•£**ã€‚

2. **æ¢ç´¢ç‡æŒ‰è§’è‰²ç¼©æ”¾ï¼ˆå·²æœ‰ï¼‰**ï¼š
   - `scale_pu=0.6, scale_su=1.4`ï¼Œä½¿ SU æ›´æ„¿æ„æ¢ç´¢ã€‚

---

## ğŸ” è®­ç»ƒä¸è¯„ä¼°æµç¨‹æ”¹åŠ¨

- ç»Ÿä¸€ä½¿ç”¨ `info["effective_actions"]`ï¼š
  - `agent.update_sticky(effective_actions, winners)`
  - æ­£åˆ™é¡¹ä¸­â€œå°è¯•æ•°/ç¢°æ’ç‡â€çš„è®¡ç®—
  - Replay å†™å…¥æ—¶ä½¿ç”¨ `effective_actions[u]`ï¼ˆä¸å¥–åŠ±åŒ¹é…ï¼‰

---

## ğŸ›  Bug ä¿®å¤

1. **æ¢ç´¢ç‡è¡°å‡ç¬”è¯¯**ï¼š`c.e_end` â†’ `c.eps_end`ï¼Œä¿®å¤ `DQN._eps()` æŠ¥é”™ã€‚  
2. **æ‰“å°è¯­å¥**ï¼š`print(f(...))` â†’ `print(f"...")`ï¼Œé¿å… `TypeError`ã€‚  
3. **éšæœºæ•°çŠ¶æ€æ±¡æŸ“**ï¼šV2X ä¿æŠ¤çª—å£æŠ½æ ·ä½¿ç”¨å±€éƒ¨ RNGã€‚

---

## ğŸ§ª é»˜è®¤è¡Œä¸ºä¸å…¼å®¹æ€§

- é»˜è®¤å…³é—­æ–°å¢ç­–ç•¥ï¼š`su_guard_frac=0.0`ã€`pu_tx_prob=1.0`ï¼Œè¡Œä¸ºä¸æ”¹é€ å‰ä¸€è‡´ã€‚  
- æ‰€æœ‰åŸæœ‰æŒ‡æ ‡ä¸å¯¼å‡ºæ–‡ä»¶ä¿æŒå‘åå…¼å®¹ï¼›`run_meta.json` å¢è¡¥è®°å½•æ–°å‚æ•°ã€‚

---

## ğŸš€ å¿«é€Ÿè¯•è¿è¡Œï¼ˆå»ºè®®èµ·ç‚¹ï¼‰

```python
EnvConfig(
    num_channels=4, num_users=8, pu_ratio=0.5, p_idle=0.7,
    use_v2x=True, v2x_latency_slots=1, v2x_noise_std=0.02,
    su_guard_frac=0.25,   # 25% ä¿¡é“ä¿æŠ¤ SU
    su_guard_rotate=True,
    pu_tx_prob=0.9        # PU 9 æˆæ¦‚ç‡å‘å°„
)
# å¯é…åˆï¼šDQNConfig.softmask_v2x_suggest=1.0~1.5, v2x_suggest_pu_malus=1.0~1.5
```

è§‚å¯ŸæŒ‡æ ‡ï¼š
- `success_su / tx_su`ï¼ˆSU æˆåŠŸç‡ï¼‰ã€`su_compete_success_rate`ï¼ˆä¸ PU ç«äº‰æ—¶ SU çš„èƒœç‡ï¼‰  
- `coll_rate`ï¼ˆç¢°æ’ç‡ï¼‰ã€`throughput`ï¼ˆå¹³å‡ååï¼‰

---

## ğŸ“Š æŒ‡æ ‡ä¸è¾“å‡ºæ–‡ä»¶

- æ—¥å¿—æ‰“å°ï¼š`SuccRate`ã€`CollRate`ã€`Throughput`ã€`Coll/100`ã€`Wait%` ç­‰ã€‚
- `outputs/sc_<tag>/metrics_multi_roles.csv`ï¼šè®°å½•æ¯å›åˆçš„ä¸»è¦æŒ‡æ ‡ï¼ˆå«æ–°å¢ SU ç«äº‰æŒ‡æ ‡ï¼‰ã€‚
- `outputs/sc_<tag>/run_meta.json`ï¼šè®°å½•æœ¬æ¬¡è¿è¡Œçš„å…³é”®ç¯å¢ƒä¸æ–°å‚æ•°ã€‚

---

## âš ï¸ æ³¨æ„äº‹é¡¹ï¼ˆPractical Notesï¼‰

- **ä¿æŠ¤çª—å£ä¸æ˜¯ç¡¬è§„åˆ™**ï¼šä»…ä½“ç°åœ¨ V2X å»ºè®®ä¸ Q å€¼åç½®ï¼Œä¸ä¼šå¼ºè¡Œç¦æ­¢ PUã€‚å®é™…çº¦æŸä»ç”±å¥–åŠ±/åç½®å¼•å¯¼å­¦ä¹ ã€‚  
- **å ç©ºæ¯”è¿‡ä½**ä¼šè®© PU è¿‡â€œä»æ…ˆâ€ï¼Œå¯è§†åŒ–å¯¹æ•´ä½“ååä¸æ—¶å»¶çš„å½±å“ï¼ŒæŒ‰éœ€æŠ˜ä¸­ `pu_tx_prob`ã€‚  
- åœ¨**é«˜ `p_miss`/ä½ `p_idle`** ä¸‹ï¼Œé€‚åº¦æ”¾å¤§ `softmask_busy_tx` ä»¥é¿å…ç›²ç›®ç¢°æ’ã€‚

---

## ğŸ” å¤ç°å®éªŒå»ºè®®ï¼ˆA/B Ablationï¼‰

åœ¨ `SCENARIOS` ä¸­å‡†å¤‡ä¸‰ç»„ï¼š
1) **Baseline**ï¼š`su_guard_frac=0.0, pu_tx_prob=1.0`  
2) **Only A**ï¼š`su_guard_frac=0.25, pu_tx_prob=1.0`  
3) **A+B**ï¼š`su_guard_frac=0.25, pu_tx_prob=0.9`  

æ¯”è¾ƒ `success_su`ã€`su_compete_success_rate`ã€`coll_rate`ã€`throughput` çš„æå‡å¹…åº¦ã€‚

---

## ğŸ“ ç‰ˆæœ¬è®°å½•ï¼ˆSummary of Diffsï¼‰

- **EnvConfig**ï¼šæ–°å¢ `su_guard_frac`, `su_guard_rotate`, `pu_tx_prob`ã€‚  
- **DQNConfig**ï¼šæ–°å¢ `v2x_suggest_pu_malus`ã€‚  
- **Env.step**ï¼šå¼•å…¥ `effective_actions`ï¼›è®¡æ•°/èµ¢å®¶/å¥–åŠ±åŸºäºæœ‰æ•ˆåŠ¨ä½œï¼›è¿”å› `effective_actions`ã€‚  
- **_build_v2x**ï¼šç¬¬ä¸‰æ®µ `rsu_suggest` æ”¹ä¸º SU ä¿æŠ¤æ©ç ï¼ˆå¯è½®åŠ¨/æŠ½æ ·ï¼‰ã€‚  
- **DQN**ï¼šåœ¨ Q å€¼ä¸Šå åŠ **è§’è‰²åŒ– V2X åç½®**ï¼›ä¿®æ­£ `_eps()`ã€‚  
- **Train/Eval**ï¼šç»Ÿä¸€ä½¿ç”¨ `effective_actions`ï¼›ä¿®å¤æ‰“å°ã€‚

---

å¦‚éœ€æˆ‘æŠŠ **ä¸‰ç»„åœºæ™¯æ¨¡æ¿** ç›´æ¥å†™è¿› `SCENARIOS` å¸®ä½ è·‘å¯¹æ¯”ï¼Œè¯·å‘Šè¯‰æˆ‘ä½ çš„ GPU æ˜¾å­˜ä¸åå¥½çš„è®­ç»ƒå›åˆæ•°ã€‚

